# Segmentation settings for cellpose
# The model's names will be used for channel names in the output store. (i.e membrane -> membrane_label)
models:
  # One can instantiate as many models
  membrane:
    path_to_model: 'cpsam' # Default: Cellpose-SAM model. Path to the pretrained model.
    eval_args:
      diameter: 65
      cellprob_threshold: 0.4
      invert: false
      do_3D: true   # Optional, if false, 2D segmentation is performed. if true, z_slice and channel_axis must be provided.
      anisotropy: 3.26
      min_size: 8000
      normalize: {"tile_norm_blocksize": 0}  # Optional, if 0, the whole image is used. Cellpose suggests 100-200 if one sees imhomogeneity
    z_slice_2D: null  # Optional, if null, 3D segmentation is performed and checks eval_args.do_3D=True
    channels: ['mem', 'nuc']
    preprocessing:
      - function: skimage.exposure.rescale_intensity  #configurable callables like rescaling intensity
        kwargs: {"out_range": [0, 1]}
        channel: 'mem'
      - function: skimage.exposure.equalize_adapthist
        kwargs: {"clip_limit": 0.01,"kernel_size":[5, 32, 32]}
        channel: 'mem'
      # One can instantiate as many models
  nucleus:
    path_to_model: 'cpsam' # Default: Cellpose-SAM model. Path to the pretrained model.
    eval_args:
      diameter: 55
      cellprob_threshold: 0.4
      invert: false
      do_3D: true   # Optional, if false, 2D segmentation is performed. if true, z_slice and channel_axis must be provided.
      anisotropy: 3.26
      min_size: 8000
      normalize: {"tile_norm_blocksize": 0}  # Optional, if 0, the whole image is used. Cellpose suggests 100-200 if one sees imhomogeneity
    z_slice_2D: null  # Optional, if null, 3D segmentation is performed and checks eval_args.do_3D=True
    channels: ['nuc','mem']
    preprocessing:
      - function: skimage.exposure.rescale_intensity  #configurable callables like rescaling intensity
        kwargs: {"out_range": [0, 1]}
        channel: 'nuc'
      - function: skimage.exposure.equalize_adapthist
        kwargs: {"clip_limit": 0.01,"kernel_size":[5, 32, 32]}
        channel: 'nuc'
